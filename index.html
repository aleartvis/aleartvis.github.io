<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Encuesta Nacional de Ocupación y Empleo (ENOE)</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
   
    .container2 {
      max-width: 900px;
      margin: 0 auto;
      background:white;
      padding: 5px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }

    /* Tarjetas superiores */
    .cards {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      flex: 1;
      background: linear-gradient(135deg, #80deea 0%, #0277bd 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .card h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.9;
    }

    .card .value {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }

    /* Tabla */
    .table-container {
      margin-bottom: 30px;
      overflow-x: auto;
    }

    .table-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

th {
  background: #0277bd 100%;
  color: white;
  padding: 15px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
}

    td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #eee;
      color: #333;
    }

    td:first-child {
      text-align: left;
      font-weight: 500;
    }

    tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    tr:hover {
      background-color: #e3f2fd;
    }

    .loading-table {
      text-align: center;
      padding: 20px;
      color: #666;
      font-style: italic;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .controls label {
      font-weight: bold;
      color: #555;
    }

    .controls select {
      padding: 10px 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      background: white;
      cursor: pointer;
    }

    .controls select:focus {
      outline: none;
      border-color: #3498db;
    }

    .chart-container {
      position: relative;
      height: 400px;
      margin-top: 20px;
    }

    .pie-chart-container {
      position: relative;
      height: 500px;
      margin-top: 40px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    /* Nuevo contenedor para las gráficas lado a lado */
    .charts-row {
      display: flex;
      gap: 20px;
      margin-top: 40px;
    }

    .chart-half {
      flex: 1;
      position: relative;
      height: 500px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 400px;
      font-size: 18px;
      color: #666;
    }

    .error {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 400px;
      font-size: 16px;
      color: #5e35b1;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .cards {
        flex-direction: column;
      }
      
      .card .value {
        font-size: 20px;
      }
      
      th, td {
        padding: 8px;
        font-size: 14px;
      }

      .charts-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>INEGI. Encuesta Nacional de Ocupación y Empleo (ENOE)</h1>
    <h1>Marzo 2025</h1>
    
    <!-- Tarjetas superiores -->
    <div class="cards">
      <div class="card">
        <h3>Población de 15 años y más</h3>
        <div class="value" id="poblaciontotal">0</div>
      </div>
      <div class="card">
        <h3>Hombres</h3>
        <div class="value" id="hombres">0%</div>
      </div>
      <div class="card">
        <h3>Mujeres</h3>
        <div class="value" id="mujeres">-</div>
      </div>
      
    </div>
    <br>
  
    <!-- Tabla de Población Activa -->
    <div class="table-container">
      <div class="table-title"></div>
      <table id="populationTable">
        <thead>
          <tr>
            <th> </th>
            <th>Total</th>
            <th>Hombres</th>
            <th>Mujeres</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="4" class="loading-table">Cargando datos de población...</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="container2">
        <h1>Población Ocupada</h1>
    </div>
    <br>
    <div class="controls">
      <label for="categoryFilter">Mostrar:</label>
      <select id="categoryFilter">
        <option value="Total">Total (Comparativo)</option>
        <option value="Hombres">Solo Hombres</option>
        <option value="Mujeres">Solo Mujeres</option>
      </select>
    </div>

    <div class="chart-container">
      <div id="loading" class="loading">Cargando datos...</div>
      <canvas id="chart" style="display: none;"></canvas>
    </div>

    <!-- Nueva tabla de Posición en la Ocupación -->
    <div class="table-container" style="margin-top: 40px;">
      <div class="table-title">Posición en la Ocupación</div>
      <div style="text-align: center; margin-bottom: 15px; color: #666; font-size: 14px; line-height: 1.4;">
        Respecto a una población de hombres total de 35,245,402 y un total de la población de mujeres de 24,484,738 en la siguiente tabla se muestran los porcentajes correspondientes a la posición en la ocupación proporcional a cada total.
      </div>
      <table id="posicionTable">
        <thead>
          <tr>
            <th>Posición en la ocupación</th>
            <th>Hombres</th>
            <th>Mujeres</th>
          </tr>
        </thead>
        <tbody id="posicionTableBody">
          <tr>
            <td colspan="3" class="loading-table">Cargando datos de posición en la ocupación...</td>
          </tr>
        </tbody>
      </table>
    </div>
<br>
    <!-- Nueva gráfica de líneas para tamaño de unidad económica -->

    
    <div class="chart-container" style="margin-top: 20px;">
      <div id="lineLoading" class="loading">Cargando datos de tamaño de unidad económica...</div>
      <canvas id="lineChart" style="display: none;"></canvas>
    </div>
    
    <!-- Contenedor para gráficas lado a lado: Jornadas (pie) y Salud Pública (barras) -->
    <div class="charts-row">
      <!-- Gráfica de pie para jornadas -->
      <div class="chart-half">
        <div id="pieLoading" class="loading">Cargando datos de jornadas...</div>
        <canvas id="pieChart" style="display: none;"></canvas>
      </div>
      
      <!-- Nueva gráfica de barras para salud pública -->
      <div class="chart-half">
        <div class="controls" style="margin-bottom: 20px;">
          <label for="saludFilter">Mostrar:</label>
          <select id="saludFilter">
            <option value="Total">Total</option>
            <option value="Hombres">Hombres</option>
            <option value="Mujeres">Mujeres</option>
          </select>
        </div>
        <div id="barLoading" class="loading">Cargando datos de salud pública...</div>
        <canvas id="barChart" style="display: none;"></canvas>
      </div>
    </div>
  </div>
  

  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  
  <script>
    // Configuración - Cambia el nombre del archivo aquí
    const CSV_FILE = 'https://github.com/aleartvis/aleartvis.github.io/blob/main/.csv';
    const POPULATION_CSV_FILE = 'https://github.com/aleartvis/aleartvis.github.io/blob/main/poblacion_activa.csv';
    const JORNADAS_CSV_FILE = 'https://raw.githubusercontent.com/aleartvis/aleartvis.github.io/main/jornadas.csv';
    const POSICION_CSV_FILE = 'https://github.com/aleartvis/aleartvis.github.io/blob/main/posicion_ocupacion.csv';
    const TAMANO_CSV_FILE = 'https://github.com/aleartvis/aleartvis.github.io/blob/main/tamano_unidad_economica.csv';
    const SALUD_CSV_FILE = 'https://github.com/aleartvis/aleartvis.github.io/blob/main/salud_publica.csv';

    let csvData = [];
    let populationData = [];
    let jornadasData = [];
    let posicionData = [];
    let tamanoData = [];
    let saludData = [];
    let chart = null;
    let pieChart = null;
    let lineChart = null;
    let barChart = null;

    // Función para parsear CSV
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        const values = [];
        let current = '';
        let inQuotes = false;
        
        // Parsear línea considerando comillas
        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            values.push(current.trim().replace(/"/g, ''));
            current = '';
          } else {
            current += char;
          }
        }
        values.push(current.trim().replace(/"/g, ''));
        
        // Crear objeto fila
        if (values.length === headers.length) {
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index];
          });
          data.push(row);
        }
      }
      
      return data;
    }

    // Función para parsear números con formato (eliminar comas)
    function parseNumber(value) {
      if (typeof value === 'string') {
        return parseInt(value.replace(/,/g, '')) || 0;
      }
      return parseInt(value) || 0;
    }

    // Función para parsear porcentajes
    function parsePercentage(value) {
      if (typeof value === 'string') {
        return parseFloat(value.replace('%', '')) || 0;
      }
      return parseFloat(value) || 0;
    }

    // Función para llenar la tabla de población
    function populateTable() {
      const tableBody = document.getElementById('tableBody');
      
      if (populationData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4" class="loading-table">Error cargando datos de población</td></tr>';
        return;
      }

      tableBody.innerHTML = '';
      
      populationData.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row['Población'] || ''}</td>
          <td>${row['Total'] || ''}</td>
          <td>${row['Hombres'] || ''}</td>
          <td>${row['Mujeres'] || ''}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // Función para llenar la tabla de posición en la ocupación
    function populatePosicionTable() {
      const tableBody = document.getElementById('posicionTableBody');
      
      if (posicionData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="3" class="loading-table">Error cargando datos de posición en la ocupación</td></tr>';
        return;
      }

      tableBody.innerHTML = '';
      
      posicionData.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row['Posición en la ocupación'] || ''}</td>
          <td>${row['Hombres'] || ''}</td>
          <td>${row['Mujeres'] || ''}</td>
        `;
        tableBody.appendChild(tr);
      });
    }

    // Función para actualizar las tarjetas
    function updateCards() {
      if (csvData.length === 0) return;

      // Población total
      document.getElementById('poblaciontotal').textContent = '102,938,507';
      // Hombres
     document.getElementById('hombres').textContent = '48,001,387';
      // Mujeres
     document.getElementById('mujeres').textContent = '54,937,120';
    }

    // Función para crear gráfica de barras de salud pública
    function createBarChart(category = 'Total') {
      const ctx = document.getElementById('barChart').getContext('2d');
      
      if (saludData.length === 0) {
        document.getElementById('barLoading').innerHTML = `
          <div class="error">
            Error: No se encontraron datos de salud pública
          </div>
        `;
        return;
      }

      // Preparar datos para la gráfica de barras
      const labels = saludData.map(row => row['Salud Pública'] || '');

      // Destruir gráfica anterior si existe
      if (barChart) {
        barChart.destroy();
      }

      let datasets = [];
      let chartTitle = '';

      if (category === 'Total') {
        // Mostrar comparativo: Hombres y Mujeres lado a lado
        const hombresValues = saludData.map(row => parsePercentage(row['Hombres']));
        const mujeresValues = saludData.map(row => parsePercentage(row['Mujeres']));

        datasets = [
          {
            label: 'Hombres (%)',
            data: hombresValues,
            backgroundColor: '#1565c0',
            borderColor: '#1565c0',
            borderWidth: 1,
            borderRadius: 6
          },
          {
            label: 'Mujeres (%)',
            data: mujeresValues,
            backgroundColor: '#ba68c8',
            borderColor: '#ba68c8',
            borderWidth: 1,
            borderRadius: 6
          }
        ];
        chartTitle = 'Acceso a Salud Pública - Comparativo';
      } else {
        // Mostrar solo la categoría seleccionada
        const values = saludData.map(row => parsePercentage(row[category]));
        const colors = {
          'Hombres': '#1565c0',   // Azul
          'Mujeres': '#ba68c8'    // Púrpura
        };

        datasets = [{
          label: `${category} (%)`,
          data: values,
          backgroundColor: colors[category],
          borderColor: colors[category],
          borderWidth: 1,
          borderRadius: 6
        }];
        chartTitle = `Acceso a Salud Pública - ${category}`;
      }

      // Crear nueva gráfica de barras
      barChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                padding: 20,
                font: {
                  size: 14
                }
              }
            },
            title: {
              display: true,
              text: chartTitle,
              font: {
                size: 16,
                weight: 'bold'
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y}%`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Porcentaje (%)'
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Acceso a Salud'
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            }
          }
        }
      });

      // Ocultar loading y mostrar gráfica
      document.getElementById('barLoading').style.display = 'none';
      document.getElementById('barChart').style.display = 'block';
    }

    // Función para crear gráfica de líneas (tamaño unidad económica)
    function createLineChart() {
      const ctx = document.getElementById('lineChart').getContext('2d');
      
      if (tamanoData.length === 0) {
        document.getElementById('lineLoading').innerHTML = `
          <div class="error">
            Error: No se encontraron datos de tamaño de unidad económica
          </div>
        `;
        return;
      }

      // Preparar datos para la gráfica de líneas
      const labels = tamanoData.map(row => {
        const label = row['Ámbito y tamaño de la unidad económica'] || '';
        // Truncar etiquetas muy largas para mejor visualización
        return label.length > 25 ? label.substring(0, 25) + '...' : label;
      });
      
      const hombresValues = tamanoData.map(row => {
        const value = row['Hombres'] || '0%';
        return parseFloat(value.replace('%', '')) || 0;
      });
      
      const mujeresValues = tamanoData.map(row => {
        const value = row['Mujeres'] || '0%';
        return parseFloat(value.replace('%', '')) || 0;
      });

      // Destruir gráfica anterior si existe
      if (lineChart) {
        lineChart.destroy();
      }

      // Crear nueva gráfica de líneas
      lineChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Hombres (%)',
              data: hombresValues,
              borderColor: '#1565c0',
              backgroundColor: 'rgba(21, 101, 192, 0.1)',
              borderWidth: 3,
              fill: false,
              tension: 0.4,
              pointBackgroundColor: '#1565c0',
              pointBorderColor: '#1565c0',
              pointHoverBackgroundColor: '#1565c0',
              pointHoverBorderColor: '#fff',
              pointRadius: 6,
              pointHoverRadius: 8
            },
            {
              label: 'Mujeres (%)',
              data: mujeresValues,
              borderColor: '#ba68c8',
              backgroundColor: 'rgba(186, 104, 200, 0.1)',
              borderWidth: 3,
              fill: false,
              tension: 0.4,
              pointBackgroundColor: '#ba68c8',
              pointBorderColor: '#ba68c8',
              pointHoverBackgroundColor: '#ba68c8',
              pointHoverBorderColor: '#fff',
              pointRadius: 6,
              pointHoverRadius: 8
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                padding: 20,
                font: {
                  size: 14
                }
              }
            },
            title: {
              display: true,
              text: 'Distribución por Ámbito y Tamaño de Unidad Económica',
              font: {
                size: 16,
                weight: 'bold'
              }
            },
            tooltip: {
              callbacks: {
                title: function(context) {
                  // Mostrar nombre completo en tooltip
                  const index = context[0].dataIndex;
                  return tamanoData[index]['Ámbito y tamaño de la unidad económica'] || '';
                },
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y}%`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Porcentaje (%)'
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Ámbito y Tamaño de Unidad Económica'
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            }
          },
          interaction: {
            intersect: false,
            mode: 'index'
          }
        }
      });

      // Ocultar loading y mostrar gráfica
      document.getElementById('lineLoading').style.display = 'none';
      document.getElementById('lineChart').style.display = 'block';
    }
    function createPieChart() {
      const ctx = document.getElementById('pieChart').getContext('2d');
      
      if (jornadasData.length === 0) {
        document.getElementById('pieLoading').innerHTML = `
          <div class="error">
            Error: No se encontraron datos de jornadas
          </div>
        `;
        return;
      }

      // Preparar datos para la gráfica de pie
      const labels = jornadasData.map(row => row['jornada'] || '');
      const values = jornadasData.map(row => parseNumber(row['total']));
      
      // Colores para la gráfica de pie
      const colors = [
        '#FF6384', // Rosa
        '#36A2EB', // Azul
        '#FFCE56', // Amarillo
        '#4BC0C0', // Verde agua
        '#9966FF', // Púrpura
        '#FF9F40', // Naranja
        '#FF6384', // Rosa claro
        '#C9CBCF'  // Gris
      ];

      // Destruir gráfica anterior si existe
      if (pieChart) {
        pieChart.destroy();
      }

      // Crear nueva gráfica de pie
      pieChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: values,
            backgroundColor: colors.slice(0, labels.length),
            borderColor: colors.slice(0, labels.length),
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'right',
              labels: {
                padding: 20,
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'Distribución por Tipo de Jornada Laboral',
              font: {
                size: 16,
                weight: 'bold'
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value.toLocaleString()} (${percentage}%)`;
                }
              }
            }
          }
        }
      });

      // Ocultar loading y mostrar gráfica
      document.getElementById('pieLoading').style.display = 'none';
      document.getElementById('pieChart').style.display = 'block';
    }

    // Función para crear/actualizar la gráfica
    function updateChart(category) {
      const ctx = document.getElementById('chart').getContext('2d');
      
      // Preparar datos
      const labels = csvData.map(row => {
        const activity = row['Actividad económica'] || '';
        // Truncar etiquetas muy largas
        return activity.length > 30 ? activity.substring(0, 30) + '...' : activity;
      });

      // Destruir gráfica anterior si existe
      if (chart) {
        chart.destroy();
      }

      let datasets = [];
      let chartTitle = '';

      if (category === 'Total') {
        // Mostrar comparativo: Hombres y Mujeres lado a lado
        const hombresValues = csvData.map(row => parseFloat(row['Hombres']) || 0);
        const mujeresValues = csvData.map(row => parseFloat(row['Mujeres']) || 0);

        datasets = [
          {
            label: 'Hombres (%)',
            data: hombresValues,
            backgroundColor: '#1565c0',
            borderColor: '#1565c0',
            borderWidth: 1,
            borderRadius: 6
          },
          {
            label: 'Mujeres (%)',
            data: mujeresValues,
            backgroundColor: '#ba68c8',
            borderColor: '#ba68c8',
            borderWidth: 1,
            borderRadius: 6
          }
        ];
        chartTitle = 'Población Ocupada por Actividad Económica';
      } else {
        // Mostrar solo la categoría seleccionada
        const values = csvData.map(row => parseFloat(row[category]) || 0);
        const colors = {
          'Hombres': '#1565c0', 
          'Mujeres': '#ba68c8'
        };

        datasets = [{
          label: `${category} (%)`,
          data: values,
          backgroundColor: colors[category],
          borderColor: colors[category],
          borderWidth: 1,
          borderRadius: 6
        }];
        chartTitle = `Distribución por Actividad Económica - ${category}`;
      }

      // Crear nueva gráfica
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            },
            title: {
              display: true,
              text: chartTitle,
              font: {
                size: 16,
                weight: 'bold'
              }
            },
            tooltip: {
              callbacks: {
                title: function(context) {
                  // Mostrar nombre completo en tooltip
                  const index = context[0].dataIndex;
                  return csvData[index]['Actividad económica'] || '';
                },
                label: function(context) {
                  return `${context.dataset.label}: ${context.parsed.y}%`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Porcentaje (%)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Actividad Económica'
              },
              ticks: {
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
    }

    // Función para cargar archivo CSV de salud pública
    async function loadSaludData() {
      try {
        const response = await fetch(SALUD_CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        saludData = parseCSV(text);
        
        console.log('Datos de salud cargados:', saludData);
        
        // Crear gráfica de barras inicial
        createBarChart('Total');
        
        // Configurar evento del filtro de salud
        document.getElementById('saludFilter').addEventListener('change', function() {
          createBarChart(this.value);
        });
        
      } catch (error) {
        console.error('Error cargando salud:', error);
        document.getElementById('barLoading').innerHTML = `
          <div class="error">
            Error cargando datos de salud pública:<br>
            ${error.message}<br><br>
            Asegúrate de que el archivo "${SALUD_CSV_FILE}" existe
          </div>
        `;
      }
    }

    // Función para cargar archivo CSV de tamaño de unidad económica
    async function loadTamanoData() {
      try {
        const response = await fetch(TAMANO_CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        tamanoData = parseCSV(text);
        
        console.log('Datos de tamaño cargados:', tamanoData);
        
        // Crear gráfica de líneas
        createLineChart();
        
      } catch (error) {
        console.error('Error cargando tamaño:', error);
        document.getElementById('lineLoading').innerHTML = `
          <div class="error">
            Error cargando datos de tamaño de unidad económica:<br>
            ${error.message}<br><br>
            Asegúrate de que el archivo "${TAMANO_CSV_FILE}" existe
          </div>
        `;
      }
    }

    // Función para cargar archivo CSV de posición en la ocupación
    async function loadPosicionData() {
      try {
        const response = await fetch(POSICION_CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        posicionData = parseCSV(text);
        
        console.log('Datos de posición cargados:', posicionData);
        
        // Llenar la tabla
        populatePosicionTable();
        
      } catch (error) {
        console.error('Error cargando posición:', error);
        document.getElementById('posicionTableBody').innerHTML = `
          <tr><td colspan="3" class="loading-table">Error: No se pudo cargar ${POSICION_CSV_FILE}<br>${error.message}</td></tr>
        `;
      }
    }

    // Función para cargar archivo CSV de jornadas
    async function loadJornadasData() {
      try {
        const response = await fetch(JORNADAS_CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        jornadasData = parseCSV(text);
        
        console.log('Datos de jornadas cargados:', jornadasData);
        
        // Crear gráfica de pie
        createPieChart();
        
      } catch (error) {
        console.error('Error cargando jornadas:', error);
        document.getElementById('pieLoading').innerHTML = `
          <div class="error">
            Error cargando datos de jornadas:<br>
            ${error.message}<br><br>
            Asegúrate de que el archivo "jornadas.csv" existe
          </div>
        `;
      }
    }

    // Función para cargar archivo CSV de población
    async function loadPopulationData() {
      try {
        const response = await fetch(POPULATION_CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        populationData = parseCSV(text);
        
        // Llenar la tabla
        populateTable();
        
      } catch (error) {
        console.error('Error cargando población:', error);
        document.getElementById('tableBody').innerHTML = 
          '<tr><td colspan="4" class="loading-table">Error: No se pudo cargar poblacion_activa.csv</td></tr>';
      }
    }

    // Función para cargar datos del CSV
    async function loadData() {
      try {
        const response = await fetch(CSV_FILE);
        
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const text = await response.text();
        csvData = parseCSV(text);
        
        if (csvData.length === 0) {
          throw new Error('No se encontraron datos en el archivo CSV');
        }
        
        // Ocultar loading y mostrar gráfica
        document.getElementById('loading').style.display = 'none';
        document.getElementById('chart').style.display = 'block';
        
        // Crear gráfica inicial con "Total"
        updateChart('Total');
        
        // Actualizar tarjetas
        updateCards();
        
        // Configurar evento del filtro
        document.getElementById('categoryFilter').addEventListener('change', function() {
          updateChart(this.value);
        });
        
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('loading').innerHTML = `
          <div class="error">
            Error cargando los datos:<br>
            ${error.message}<br><br>
            Asegúrate de que:<br>
            • El archivo "${CSV_FILE}" existe<br>
            • Estás ejecutando desde localhost:8000<br>
            • El formato del CSV es correcto
          </div>
        `;
      }
    }

    // Inicializar cuando se carga la página
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      loadPopulationData();
      loadJornadasData();
      loadPosicionData();
      loadTamanoData();
      loadSaludData();
    });
  </script>
</body>
</html>
